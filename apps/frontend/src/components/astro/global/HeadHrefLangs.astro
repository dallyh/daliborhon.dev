---
import { defaultLocale, locales } from "@daliborhon.dev/shared/frontend/i18n";
import { getPathFromUrl } from "@i18n/utils";
import { getBlogArticleByLocale } from "@services/content/getBlogArticleByLocale";
import type { IGenBlogArticleMetaFragment } from "@services/graphql/__generated/sdk";
import { getAbsoluteBlogPostUrl } from "@utils";
import { getAbsoluteLocaleUrl } from "astro:i18n";

interface Props {
    post?: IGenBlogArticleMetaFragment;
}
const { post } = Astro.props;
---

<Fragment>
    <link rel="alternate" hreflang="x-default" href={getAbsoluteLocaleUrl(defaultLocale, getPathFromUrl(Astro.url))} />
    {!post && locales.map((locale) => <link rel="alternate" hreflang={locale} href={getAbsoluteLocaleUrl(locale, getPathFromUrl(Astro.url))} />)}
    {
        post &&
            locales.map(async (locale) => {
                if (locale === post?._meta?.locale) {
                    const value = getAbsoluteBlogPostUrl(locale, post);
                    return <link rel="alternate" hreflang={locale} href={value} />;
                }
                const currentPost = await getBlogArticleByLocale({ locale, id: post?.id! });
                const value = getAbsoluteBlogPostUrl(locale, currentPost);
                return <link rel="alternate" hreflang={locale} href={value} />;
            })
    }
</Fragment>
