---
import { locales } from "@i18n/config";
import { getRoutingLocale } from "@i18n/utils";
import BlogPostLayout from "@layouts/BlogPostLayout.astro";
import { getAllBlogArticlesByLocale } from "@services/content/getAllBlogArticlesByLocale";
import { getBlogPostSlug } from "@utils";

export async function getStaticPaths() {
    const paths = await Promise.all(
        locales.map(async (locale) => {
            const posts = (await getAllBlogArticlesByLocale({ locale })) ?? [];

            if (posts === undefined) {
                return [];
            }

            return posts.map((post) => ({
                params: {
                    lang: getRoutingLocale(locale),
                    slug: getBlogPostSlug(locale, post),
                },
                props: {
                    post: post,
                },
            }));
        }),
    );

    return paths.flat();
}

const { post } = Astro.props;
---

<BlogPostLayout post={post} />
