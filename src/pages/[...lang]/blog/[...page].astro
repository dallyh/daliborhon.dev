---
import { getCollection } from "astro:content";
import type { GetStaticPathsOptions } from "astro";
import { defaultLocale, locales } from "@config/i18n";
import BlogLayout from "@layouts/BlogLayout.astro";
import { BLOG } from "src/config/blog";
import { getRoutingLocale } from "@i18n/utils";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
    const posts = await getCollection("posts", ({ data }) => {
        return !data.hidden;
    });

    console.log("Posts:" + posts.length);

    return locales.flatMap((locale) => {
        console.log("Locale: " + locale);
        const filteredPosts = posts
            .filter((post) => {
                return post.data.language === locale;
            })
            .sort((a, b) => new Date(b.data.pubDateTime).valueOf() - new Date(a.data.pubDateTime).valueOf());

            console.log("Filtered: " + filteredPosts.length);

        return paginate(filteredPosts, {
            params: { lang: getRoutingLocale(locale) },
            pageSize: BLOG.pageSize,
        });
    });
}

const { page } = Astro.props;
---

<BlogLayout page={page} />
