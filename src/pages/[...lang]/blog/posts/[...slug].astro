---
import { getCollection, getEntry } from "astro:content";
import BlogPostLayout from "@layouts/BlogPostLayout.astro";
import { defaultLocale, getLocale } from "astro-i18n-aut";

export async function getStaticPaths() {
    const pages = await getCollection("posts");
    const paths = pages.map((page) => {
        const [lang, slug] = page.slug.split("/");
        return { params: { lang: lang === defaultLocale ? undefined : lang, slug: slug || undefined }, props: page };  
    });

    return paths;
}

const locale = getLocale(Astro.url);
const { slug } = Astro.params;

const post = await getEntry({
    collection: "posts",
    slug: locale + "/" + slug,
});
if (!post) {
    return new Response(null, {
        status: 404,
        statusText: "Not found",
    });
}

const { Content } = await post.render();
---

<BlogPostLayout frontmatter={post.data}>
    <Content />
</BlogPostLayout>
