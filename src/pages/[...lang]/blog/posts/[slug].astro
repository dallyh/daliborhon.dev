---
import { getCollection, getEntry, getEntryBySlug } from "astro:content";
import BlogPostLayout from "@layouts/BlogPostLayout.astro";
import { getLocale } from "@i18n/utils";
import { defaultLocale } from "@i18n/consts";

export async function getStaticPaths() {
    const allPosts = await getCollection("posts");
    const paths = allPosts.map((post) => {
        return { params: { lang: post.data.language === defaultLocale ? undefined : post.data.language, slug: post.slug } };  
    });

    return paths;
}

const { slug } = Astro.params;
const post = await getEntry({
    collection: "posts",
    slug: slug,
});
if (!post) {
    return new Response(null, {
        status: 404,
        statusText: "Not found",
    });
}

const { Content } = await post.render();
---

<BlogPostLayout post={post}>
    <Content />
</BlogPostLayout>
